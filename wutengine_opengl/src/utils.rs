//! TODO: As soon as this is more than about 300 lines, refactor and split
